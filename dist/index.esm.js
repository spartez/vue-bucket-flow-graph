import t from"vue";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var r,i,o,u="object",s=function(t){return t&&t.Math==Math&&t},c=s(typeof globalThis==u&&globalThis)||s(typeof window==u&&window)||s(typeof self==u&&self)||s(typeof e==u&&e)||Function("return this")(),a=function(t){try{return!!t()}catch(t){return!0}},h=!a(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),l={}.propertyIsEnumerable,f=Object.getOwnPropertyDescriptor,p={f:f&&!l.call({1:2},1)?function(t){var e=f(this,t);return!!e&&e.enumerable}:l},d=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},g={}.toString,b=function(t){return g.call(t).slice(8,-1)},v="".split,y=a(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==b(t)?v.call(t,""):Object(t)}:Object,m=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},S=function(t){return y(m(t))},x=function(t){return"object"==typeof t?null!==t:"function"==typeof t},k=function(t,e){if(!x(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!x(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!x(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!x(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},w={}.hasOwnProperty,_=function(t,e){return w.call(t,e)},O=c.document,I=x(O)&&x(O.createElement),W=function(t){return I?O.createElement(t):{}},M=!h&&!a(function(){return 7!=Object.defineProperty(W("div"),"a",{get:function(){return 7}}).a}),N=Object.getOwnPropertyDescriptor,H={f:h?N:function(t,e){if(t=S(t),e=k(e,!0),M)try{return N(t,e)}catch(t){}if(_(t,e))return d(!p.f.call(t,e),t[e])}},E=function(t){if(!x(t))throw TypeError(String(t)+" is not an object");return t},Y=Object.defineProperty,z={f:h?Y:function(t,e,n){if(E(t),e=k(e,!0),E(n),M)try{return Y(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},j=h?function(t,e,n){return z.f(t,e,d(1,n))}:function(t,e,n){return t[e]=n,t},T=function(t,e){try{j(c,t,e)}catch(n){c[t]=e}return e},q=n(function(t){var e=c["__core-js_shared__"]||T("__core-js_shared__",{});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),A=q("native-function-to-string",Function.toString),C=c.WeakMap,F="function"==typeof C&&/native code/.test(A.call(C)),R=0,X=Math.random(),B=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++R+X).toString(36)},P=q("keys"),$=function(t){return P[t]||(P[t]=B(t))},G={},D=c.WeakMap;if(F){var V=new D,L=V.get,U=V.has,K=V.set;r=function(t,e){return K.call(V,t,e),e},i=function(t){return L.call(V,t)||{}},o=function(t){return U.call(V,t)}}else{var Z=$("state");G[Z]=!0,r=function(t,e){return j(t,Z,e),e},i=function(t){return _(t,Z)?t[Z]:{}},o=function(t){return _(t,Z)}}var J={set:r,get:i,has:o,enforce:function(t){return o(t)?i(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!x(e)||(n=i(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Q=n(function(t){var e=J.get,n=J.enforce,r=String(A).split("toString");q("inspectSource",function(t){return A.call(t)}),(t.exports=function(t,e,i,o){var u=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,a=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||_(i,"name")||j(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==c?(u?!a&&t[e]&&(s=!0):delete t[e],s?t[e]=i:j(t,e,i)):s?t[e]=i:T(e,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||A.call(this)})}),tt=c,et=function(t){return"function"==typeof t?t:void 0},nt=function(t,e){return arguments.length<2?et(tt[t])||et(c[t]):tt[t]&&tt[t][e]||c[t]&&c[t][e]},rt=Math.ceil,it=Math.floor,ot=function(t){return isNaN(t=+t)?0:(t>0?it:rt)(t)},ut=Math.min,st=function(t){return t>0?ut(ot(t),9007199254740991):0},ct=Math.max,at=Math.min,ht=function(t,e){var n=ot(t);return n<0?ct(n+e,0):at(n,e)},lt=function(t){return function(e,n,r){var i,o=S(e),u=st(o.length),s=ht(r,u);if(t&&n!=n){for(;u>s;)if((i=o[s++])!=i)return!0}else for(;u>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}},ft={includes:lt(!0),indexOf:lt(!1)},pt=ft.indexOf,dt=function(t,e){var n,r=S(t),i=0,o=[];for(n in r)!_(G,n)&&_(r,n)&&o.push(n);for(;e.length>i;)_(r,n=e[i++])&&(~pt(o,n)||o.push(n));return o},gt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],bt=gt.concat("length","prototype"),vt={f:Object.getOwnPropertyNames||function(t){return dt(t,bt)}},yt={f:Object.getOwnPropertySymbols},mt=nt("Reflect","ownKeys")||function(t){var e=vt.f(E(t)),n=yt.f;return n?e.concat(n(t)):e},St=function(t,e){for(var n=mt(e),r=z.f,i=H.f,o=0;o<n.length;o++){var u=n[o];_(t,u)||r(t,u,i(e,u))}},xt=/#|\.prototype\./,kt=function(t,e){var n=_t[wt(t)];return n==It||n!=Ot&&("function"==typeof e?a(e):!!e)},wt=kt.normalize=function(t){return String(t).replace(xt,".").toLowerCase()},_t=kt.data={},Ot=kt.NATIVE="N",It=kt.POLYFILL="P",Wt=kt,Mt=H.f,Nt=function(t,e){var n,r,i,o,u,s=t.target,a=t.global,h=t.stat;if(n=a?c:h?c[s]||T(s,{}):(c[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(u=Mt(n,r))&&u.value:n[r],!Wt(a?r:s+(h?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;St(o,i)}(t.sham||i&&i.sham)&&j(o,"sham",!0),Q(n,r,o,t)}},Ht=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Et=function(t){return Object(m(t))},Yt=Array.isArray||function(t){return"Array"==b(t)},zt=!!Object.getOwnPropertySymbols&&!a(function(){return!String(Symbol())}),jt=c.Symbol,Tt=q("wks"),qt=function(t){return Tt[t]||(Tt[t]=zt&&jt[t]||(zt?jt:B)("Symbol."+t))},At=qt("species"),Ct=function(t,e){var n;return Yt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!Yt(n.prototype)?x(n)&&null===(n=n[At])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Ft=[].push,Rt=function(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,u=5==t||o;return function(s,c,a,h){for(var l,f,p=Et(s),d=y(p),g=function(t,e,n){if(Ht(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}(c,a,3),b=st(d.length),v=0,m=h||Ct,S=e?m(s,b):n?m(s,0):void 0;b>v;v++)if((u||v in d)&&(f=g(l=d[v],v,p),t))if(e)S[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:Ft.call(S,l)}else if(i)return!1;return o?-1:r||i?i:S}},Xt={forEach:Rt(0),map:Rt(1),filter:Rt(2),some:Rt(3),every:Rt(4),find:Rt(5),findIndex:Rt(6)},Bt=qt("species"),Pt=function(t){return!a(function(){var e=[];return(e.constructor={})[Bt]=function(){return{foo:1}},1!==e[t](Boolean).foo})},$t=Xt.filter;Nt({target:"Array",proto:!0,forced:!Pt("filter")},{filter:function(t){return $t(this,t,arguments.length>1?arguments[1]:void 0)}});var Gt=Object.keys||function(t){return dt(t,gt)},Dt=h?Object.defineProperties:function(t,e){E(t);for(var n,r=Gt(e),i=r.length,o=0;i>o;)z.f(t,n=r[o++],e[n]);return t},Vt=nt("document","documentElement"),Lt=$("IE_PROTO"),Ut=function(){},Kt=function(){var t,e=W("iframe"),n=gt.length;for(e.style.display="none",Vt.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Kt=t.F;n--;)delete Kt.prototype[gt[n]];return Kt()},Zt=Object.create||function(t,e){var n;return null!==t?(Ut.prototype=E(t),n=new Ut,Ut.prototype=null,n[Lt]=t):n=Kt(),void 0===e?n:Dt(n,e)};G[Lt]=!0;var Jt=qt("unscopables"),Qt=Array.prototype;null==Qt[Jt]&&j(Qt,Jt,Zt(null));var te=function(t){Qt[Jt][t]=!0},ee=Xt.find,ne=!0;"find"in[]&&Array(1).find(function(){ne=!1}),Nt({target:"Array",proto:!0,forced:ne},{find:function(t){return ee(this,t,arguments.length>1?arguments[1]:void 0)}}),te("find");var re=ft.includes;Nt({target:"Array",proto:!0},{includes:function(t){return re(this,t,arguments.length>1?arguments[1]:void 0)}}),te("includes");var ie=function(t,e){var n=[][t];return!n||!a(function(){n.call(null,e||function(){throw 1},1)})},oe=[].join,ue=y!=Object,se=ie("join",",");Nt({target:"Array",proto:!0,forced:ue||se},{join:function(t){return oe.call(S(this),void 0===t?",":t)}});var ce=Xt.map;Nt({target:"Array",proto:!0,forced:!Pt("map")},{map:function(t){return ce(this,t,arguments.length>1?arguments[1]:void 0)}});var ae=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return E(n),function(t){if(!x(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),he="[\t\n\v\f\r                　\u2028\u2029\ufeff]",le=RegExp("^"+he+he+"*"),fe=RegExp(he+he+"*$"),pe=function(t){return function(e){var n=String(m(e));return 1&t&&(n=n.replace(le,"")),2&t&&(n=n.replace(fe,"")),n}},de={start:pe(1),end:pe(2),trim:pe(3)},ge=vt.f,be=H.f,ve=z.f,ye=de.trim,me=c.Number,Se=me.prototype,xe="Number"==b(Zt(Se)),ke=function(t){var e,n,r,i,o,u,s,c,a=k(t,!1);if("string"==typeof a&&a.length>2)if(43===(e=(a=ye(a)).charCodeAt(0))||45===e){if(88===(n=a.charCodeAt(2))||120===n)return NaN}else if(48===e){switch(a.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+a}for(u=(o=a.slice(2)).length,s=0;s<u;s++)if((c=o.charCodeAt(s))<48||c>i)return NaN;return parseInt(o,r)}return+a};if(Wt("Number",!me(" 0o1")||!me("0b1")||me("+0x1"))){for(var we,_e=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof _e&&(xe?a(function(){Se.valueOf.call(n)}):"Number"!=b(n))?function(t,e,n){var r,i;return ae&&"function"==typeof(r=e.constructor)&&r!==n&&x(i=r.prototype)&&i!==n.prototype&&ae(t,i),t}(new me(ke(e)),n,_e):ke(e)},Oe=h?ge(me):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Ie=0;Oe.length>Ie;Ie++)_(me,we=Oe[Ie])&&!_(_e,we)&&ve(_e,we,be(me,we));_e.prototype=Se,Se.constructor=_e,Q(c,"Number",_e)}var We=qt("match"),Me=function(t){if(function(t){var e;return x(t)&&(void 0!==(e=t[We])?!!e:"RegExp"==b(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t},Ne=qt("match");function He(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ee(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){He(t,e,n[e])})}return t}function Ye(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Nt({target:"String",proto:!0,forced:!function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Ne]=!1,"/./"[t](e)}catch(t){}}return!1}("includes")},{includes:function(t){return!!~String(m(this)).indexOf(Me(t),arguments.length>1?arguments[1]:void 0)}});const ze=(t,e,n={})=>{if(!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let r,i,o=[];return function(...u){return new Promise(s=>{const c=n.leading&&!i;clearTimeout(i),i=setTimeout(()=>{i=null;const e=n.leading?r:t.apply(this,u);for(s of o)s(e);o=[]},e),c?(r=t.apply(this,u),s(r)):o.push(s)})}};var je=ze,Te=ze;je.default=Te;var qe=Xt.findIndex,Ae=!0;"findIndex"in[]&&Array(1).findIndex(function(){Ae=!1}),Nt({target:"Array",proto:!0,forced:Ae},{findIndex:function(t){return qe(this,t,arguments.length>1?arguments[1]:void 0)}}),te("findIndex");var Ce=function(t,e,n){var r=k(e);r in t?z.f(t,r,d(0,n)):t[r]=n},Fe=Math.max,Re=Math.min;Nt({target:"Array",proto:!0,forced:!Pt("splice")},{splice:function(t,e){var n,r,i,o,u,s,c=Et(this),a=st(c.length),h=ht(t,a),l=arguments.length;if(0===l?n=r=0:1===l?(n=0,r=a-h):(n=l-2,r=Re(Fe(ot(e),0),a-h)),a+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=Ct(c,r),o=0;o<r;o++)(u=h+o)in c&&Ce(i,o,c[u]);if(i.length=r,n<r){for(o=h;o<a-r;o++)s=o+n,(u=o+r)in c?c[s]=c[u]:delete c[s];for(o=a;o>a-r+n;o--)delete c[o-1]}else if(n>r)for(o=a-r;o>h;o--)s=o+n-1,(u=o+r-1)in c?c[s]=c[u]:delete c[s];for(o=0;o<n;o++)c[o+h]=arguments[o+2];return c.length=a-r+n,i}});var Xe=function(t,e,n,r,i,o,u,s,c,a){"boolean"!=typeof u&&(c=s,s=u,u=!1);var h,l="function"==typeof n?n.options:n;if(t&&t.render&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns,l._compiled=!0,i&&(l.functional=!0)),r&&(l._scopeId=r),o?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=h):e&&(h=u?function(){e.call(this,a(this.$root.$options.shadowRoot))}:function(t){e.call(this,s(t))}),h)if(l.functional){var f=l.render;l.render=function(t,e){return h.call(e),f(t,e)}}else{var p=l.beforeCreate;l.beforeCreate=p?[].concat(p,h):[h]}return n};const Be={name:"Bucket",props:{bucket:{type:Object,required:!0},borderRadius:{type:Number,default:0},bucketWidth:{type:Number,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},yScale:{type:Number,required:!0},stepScale:{type:Number,required:!0}},data:function(){return{inputSlots:[],outputSlots:[]}},computed:{id:function(){return this.bucket.id},color:function(){return this.bucket.color},title:function(){return this.bucket.title},value:function(){return this.bucket.value||this.bucket.entities.length},height:function(){var t=(this.bucket.value||this.bucket.entities&&this.bucket.entities.length)*this.yScale*this.stepScale;return Math.max(t,3)},dropValue:function(){return this.bucket.drop&&this.bucket.drop.length||0},dropPercent:function(){return Math.round(this.dropValue/this.value*100)},dropHeight:function(){return this.dropValue>0?this.dropValue*this.yScale*this.stepScale:0},dropWidth:function(){return 5+Math.min(40,this.dropHeight)}},watch:{height:{handler:function(t){this.$emit("height-change",t)},immediate:!0}},updated:function(){this.recalculateSlots()},methods:{recalculateSlots:function(){for(var t=0;t<this.inputSlots.length;t+=1){var e=this.inputSlots[t-1]?this.inputSlots[t-1]:{y:this.y,height:0},n=e.y,r=e.height;this.inputSlots[t].x=this.x,this.inputSlots[t].y=n+r,this.inputSlots[t].height=Math.max(this.inputSlots[t].value*this.yScale*this.stepScale,3)}for(var i=0;i<this.outputSlots.length;i+=1){var o=this.outputSlots[i-1]?this.outputSlots[i-1]:{y:this.y,height:0};n=o.y,r=o.height;this.outputSlots[i].x=this.x+this.bucketWidth,this.outputSlots[i].y=n+r,this.outputSlots[i].height=Math.max(this.outputSlots[i].value*this.yScale*this.stepScale,3)}},acquireInputSlot:function(t,e){var n=this,r={value:t,weight:e,x:this.x,y:0,bucketValue:this.value,height:t*this.yScale*this.stepScale,color:this.color,free:function(){return n.freeInputSlot(r)}};return this.inputSlots.push(r),this.recalculateSlots(),this.inputSlots[this.inputSlots.length-1]},acquireOutputSlot:function(t,e){var n=this,r={value:t,weight:e,bucketValue:this.value,x:this.x+this.bucketWidth,y:0,height:t*this.yScale*this.stepScale,color:this.color,free:function(){return n.freeOutputSlot(r)}};return this.outputSlots.push(r),this.recalculateSlots(),this.outputSlots[this.outputSlots.length-1]},freeInputSlot:function(t){var e=this.inputSlots.findIndex(function(e){return e===t});this.inputSlots.splice(e,1)},freeOutputSlot:function(t){var e=this.outputSlots.findIndex(function(e){return e===t});this.outputSlots.splice(e,1)}}};var Pe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{staticClass:"bucket",attrs:{transform:"translate(0 "+t.y+")"}},[n("rect",{attrs:{x:0,y:-t.borderRadius,width:t.bucketWidth,height:t.height+2*t.borderRadius,fill:t.color,rx:t.borderRadius,ry:t.borderRadius}}),t._v(" "),n("g",{attrs:{transform:"translate("+t.bucketWidth/2+" "+t.height/2+")"}},[n("text",{style:{textShadow:"0 0 4px "+t.color},attrs:{"alignment-baseline":"baseline","text-anchor":"middle",x:0,y:-6,stroke:t.color}},[t._v("\n            "+t._s(t.title)+"\n        ")]),t._v(" "),n("text",{staticClass:"value",style:{textShadow:"0 0 4px "+t.color},attrs:{"alignment-baseline":"hanging","text-anchor":"middle",stroke:t.color,x:0,y:0}},[t._v("\n            "+t._s(t.value)+"\n        ")])]),t._v(" "),t.dropHeight>0?n("g",{staticClass:"drop",attrs:{opacity:"0.8",transform:"translate("+t.bucketWidth+" "+(t.height-t.dropHeight)+")"}},[n("path",{attrs:{d:"M 0 0 A "+t.dropWidth+" "+t.dropWidth+" 0 0 1 "+t.dropWidth+" "+t.dropWidth+" L 0 "+t.dropWidth,fill:"#ff5630"}}),t._v(" "),n("rect",{attrs:{x:0,y:t.dropWidth,width:t.dropWidth,height:t.dropHeight,fill:"url(#gradient-drop)",rx:t.borderRadius,ry:t.borderRadius}}),t._v(" "),n("text",{attrs:{x:t.dropWidth-Math.sqrt(t.dropWidth)+5,y:t.dropWidth/2}},[t._v("\n            "+t._s(t.dropPercent)+"%\n        ")])]):t._e()])};Pe._withStripped=!0;const $e={name:"Step",components:{Bucket:Xe({render:Pe,staticRenderFns:[]},void 0,Be,"data-v-7360eb64",!1,void 0,void 0,void 0)},props:{stepData:{type:Object,required:!0},bucketWidth:{type:Number,required:!0},bucketMargin:{type:Number,required:!0},borderRadius:{type:Number,default:3},x:{type:Number,required:!0},yScale:{type:Number,required:!0},containerHeight:{type:Number,required:!0}},data:function(){return{bucketsHeights:this.stepData.buckets.map(function(){return 0}),autoScale:1}},computed:{id:function(){return this.stepData.id},title:function(){return this.stepData.title},buckets:function(){return this.stepData.buckets},bucketsY:function(){var t=this,e=0;return this.bucketsHeights.map(function(n){var r=e;return e+=n+t.bucketMargin,r})},bucketsHeightSum:function(){return this.bucketsHeights.reduce(function(t,e){return t+e},0)},marginsSum:function(){return(this.buckets.length-1)*this.bucketMargin},stepScale:function(){return"auto"===this.stepData.scale?this.autoScale/this.yScale:this.stepData.scale||1},xOut:function(){return this.x+this.bucketWidth}},watch:{bucketsHeightSum:{handler:function(t){"auto"!==this.stepData.scale&&this.$emit("height-change",t,this.marginsSum)},immediate:!1}},mounted:function(){"auto"===this.stepData.scale&&this.calculateAutoHeight()},methods:{onBucketHeightChange:function(e,n){t.set(this.bucketsHeights,e,n)},calculateAutoHeight:function(){var t=this.$refs.buckets.reduce(function(t,e){return t+e.value},0),e=(this.buckets.length-1)*this.bucketMargin,n=(this.containerHeight-e)/t;this.autoScale=n},acquireInputSlot:function(t,e,n){return this.$refs.buckets.find(function(e){return e.id===t}).acquireInputSlot(e,n)},acquireOutputSlot:function(t,e,n){return this.$refs.buckets.find(function(e){return e.id===t}).acquireOutputSlot(e,n)}}};var Ge=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{staticClass:"step",attrs:{transform:"translate("+t.x+" 0)"}},[n("text",{attrs:{"text-anchor":"middle",x:t.bucketWidth/2,y:-t.borderRadius-20}},[t._v("\n        "+t._s(t.title)+"\n    ")]),t._v(" "),t._l(t.buckets,function(e,r){return n("Bucket",{key:e.title,ref:"buckets",refInFor:!0,attrs:{x:t.x,y:t.bucketsY[r],"y-scale":t.yScale,"step-scale":t.stepScale,bucket:e,"bucket-width":t.bucketWidth},on:{"height-change":function(e){return t.onBucketHeightChange(r,e)}}})})],2)};Ge._withStripped=!0;var De=Xe({render:Ge,staticRenderFns:[]},void 0,$e,"data-v-8c1326ca",!1,void 0,void 0,void 0),Ve=[].sort,Le=[1,2,3],Ue=a(function(){Le.sort(void 0)}),Ke=a(function(){Le.sort(null)}),Ze=ie("sort");Nt({target:"Array",proto:!0,forced:Ue||!Ke||Ze},{sort:function(t){return void 0===t?Ve.call(Et(this)):Ve.call(Et(this),Ht(t))}});var Je=qt("isConcatSpreadable"),Qe=!a(function(){var t=[];return t[Je]=!1,t.concat()[0]!==t}),tn=Pt("concat"),en=function(t){if(!x(t))return!1;var e=t[Je];return void 0!==e?!!e:Yt(t)};Nt({target:"Array",proto:!0,forced:!Qe||!tn},{concat:function(t){var e,n,r,i,o,u=Et(this),s=Ct(u,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?u:arguments[e],en(o)){if(c+(i=st(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,c++)n in o&&Ce(s,c,o[n])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Ce(s,c++,o)}return s.length=c,s}});const nn={name:"Flow",inject:["acquireInputSlot","acquireOutputSlot","setGradient"],props:{source:{type:Object,required:!0},target:{type:Object,required:!0},entities:{type:Array,required:!0},bucketWidth:{type:Number,required:!0}},data:function(){return{output:{x:0,y:0,height:0},input:{x:0,y:0,height:0},labelHeight:0,labelWidth:0}},computed:{value:function(){return this.entities.length},percent:function(){return this.value/this.output.bucketValue},percentFormatted:function(){return this.percent<.01?"<1":Math.round(100*this.percent)},id:function(){return"".concat(this.source.step,"-").concat(this.source.bucket,"-").concat(this.target.step,"-").concat(this.target.bucket)},width:function(){return Math.abs(this.inputX-this.outputX)},outputTopBezier:function(){var t=Math.abs(this.outputY1-this.outputY2),e=Math.abs(this.outputY1-this.inputY1);return this.bezierWidth/2+t/2-e/(this.bezierWidth+1)*3},outputBottomBezier:function(){var t=Math.abs(this.outputY1-this.outputY2),e=Math.abs(this.outputY2-this.inputY2);return this.bezierWidth/2-t/2-e/(this.bezierWidth+1)*3},inputTopBezier:function(){var t=Math.abs(this.inputY1-this.inputY2),e=Math.abs(this.outputY1-this.inputY1);return this.bezierWidth/2+t/2-e/(this.bezierWidth+1)*3},inputBottomBezier:function(){var t=Math.abs(this.inputY1-this.inputY2),e=Math.abs(this.outputY2-this.inputY2);return this.bezierWidth/2-t/2-e/(this.bezierWidth+1)*3},skipsOverNextStep:function(){return this.width>2*this.bucketWidth},extensionWidth:function(){return this.skipsOverNextStep?this.width-this.bucketWidth:0},bezierWidth:function(){return this.skipsOverNextStep?this.width-this.extensionWidth:this.width},bezierHeight1:function(){return Math.round(100*(this.inputY1-this.outputY1))/100},bezierHeight2:function(){return Math.round(100*(this.outputY2-this.inputY2))/100},fontSize:function(){var t=.7+this.value/this.input.bucketValue*.3;return"".concat(t,"em")},labelRadius:function(){return 5},inputHeight:function(){return Math.round(100*Math.abs(this.inputY1-this.inputY2))/100},outputHeight:function(){return Math.round(100*Math.abs(this.outputY1-this.outputY2))/100},hasSameScales:function(){return this.inputHeight===this.outputHeight&&this.outputY1!==this.inputY1},path:function(){return this.hasSameScales?["M ".concat(this.outputX," ").concat(this.outputY1+this.inputHeight/2),this.skipsOverNextStep?"h ".concat(this.extensionWidth):"","c ".concat((this.outputTopBezier+this.outputBottomBezier)/2," ",0,", ").concat((this.inputTopBezier+this.inputBottomBezier)/2," ").concat(this.bezierHeight1,", ").concat(this.bezierWidth," ").concat(this.bezierHeight1)].join(" "):["M ".concat(this.outputX," ").concat(this.outputY1),this.skipsOverNextStep?"h ".concat(this.extensionWidth):"","c ".concat(this.outputTopBezier," ",0,", ").concat(this.inputTopBezier," ").concat(this.bezierHeight1,", ").concat(this.bezierWidth," ").concat(this.bezierHeight1),"L ".concat(this.inputX," ").concat(this.inputY2),"c ".concat(-this.inputBottomBezier," ",0,", ").concat(-this.outputBottomBezier," ").concat(this.bezierHeight2,", ").concat(-this.bezierWidth," ").concat(this.bezierHeight2),this.skipsOverNextStep?"h ".concat(-this.extensionWidth):"","Z"].join(" ")},outputX:function(){return this.output.x},outputY1:function(){return this.output.y},outputY2:function(){return this.output.y+this.output.height},inputX:function(){return this.input.x},inputY1:function(){return this.input.y},inputY2:function(){return this.input.y+this.input.height},middleX:function(){return this.outputX+this.width/2},middleY:function(){return this.skipsOverNextStep?(this.outputY1+this.outputY2)/2:((this.outputY1+this.outputY2)/2+(this.inputY1+this.inputY2)/2)/2}},watch:{fontSize:function(){var t=this;this.$nextTick(function(){var e=t.$refs.labels.getBoundingClientRect(),n=e.width,r=e.height;t.labelHeight=r+4,t.labelWidth=n+8})},inputX:function(){this.setGradient({id:this.id,fromColor:this.output.color,toColor:this.input.color,outputX:this.output.x,inputX:this.input.x})},outputX:function(){this.setGradient({id:this.id,fromColor:this.output.color,toColor:this.input.color,outputX:this.output.x,inputX:this.input.x})},value:function(){this.input.free(),this.output.free(),this.acquireSlots()}},mounted:function(){this.acquireSlots(),this.setFlowGradient()},beforeDestroy:function(){this.input.free(),this.output.free()},methods:{acquireSlots:function(){var t=1e3*Math.abs(this.source.stepIndex-this.target.stepIndex)+this.target.bucketIndex;this.output=this.acquireOutputSlot(this.source.step,this.source.bucket,this.entities.length,t);var e=1e3*Math.abs(this.source.stepIndex-this.target.stepIndex)+this.source.bucketIndex;this.input=this.acquireInputSlot(this.target.step,this.target.bucket,this.entities.length,e)},setFlowGradient:function(){this.setGradient({id:this.id,fromColor:this.output.color,toColor:this.input.color,outputX:this.output.x,inputX:this.input.x})}}};var rn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",[n("g",{staticClass:"flow",attrs:{opacity:"0.5"}},[t.hasSameScales?n("path",{attrs:{stroke:"url('#gradient-"+t.id+"')","stroke-width":t.inputHeight,fill:"none",d:t.path}}):n("path",{attrs:{fill:"url('#gradient-"+t.id+"')",d:t.path}}),t._v(" "),n("rect",{attrs:{fill:"url('#gradient-"+t.id+"')",x:t.middleX-t.labelWidth/2,y:t.middleY-t.labelHeight/2,width:t.labelWidth,height:t.labelHeight,rx:5,ry:5}})]),t._v(" "),n("g",{ref:"labels",staticClass:"labels"},[n("text",{attrs:{"font-size":t.fontSize,x:t.middleX,y:t.middleY-1,"dominant-baseline":"baseline","text-anchor":"middle"}},[t._v("\n            "+t._s(t.percentFormatted)+"%\n        ")]),t._v(" "),n("text",{style:{transformOrigin:t.middleX+"px "+t.middleY+"px",transform:"scale(.7)"},attrs:{"font-size":t.fontSize,x:t.middleX,y:t.middleY+3,"dominant-baseline":"hanging","text-anchor":"middle"}},[t._v("\n            ("+t._s(t.value)+")\n        ")])])])};rn._withStripped=!0;var on=Xe({render:rn,staticRenderFns:[]},void 0,nn,"data-v-05db7b6e",!1,void 0,void 0,void 0),un=function(t){return t.entities||[]},sn=function(t){return t.reduce(function(e,n,r){return r>=t.length-1?e:[].concat(Ye(e),Ye(n.buckets.reduce(function(e,i,o){return[].concat(Ye(e),Ye(un(i).reduce(function(e,u){var s=function(t,e,n){for(var r=e;r<t.length;r+=1){var i=t[r],o=i.buckets.findIndex(function(t){return un(t).find(function(t){return t.id===n.id})});if(-1!==o){var u=i.buckets[o];return{step:i.id,stepIndex:r,bucket:u.id,bucketIndex:o}}}}(t,r+1,u);if(!s)return e;var c=e.find(function(t){var e=t.target;return e.step===s.step&&e.bucket===s.bucket});return c?(c.entities=[].concat(Ye(c.entities),[u]),e):[].concat(Ye(e),[{source:{stepIndex:r,bucketIndex:o,step:n.id,bucket:i.id},target:{stepIndex:s.stepIndex,bucketIndex:s.bucketIndex,step:s.step,bucket:s.bucket},entities:[u]}])},[])))},[])))},[])},cn=function(t,e){return t.buckets&&t.buckets[e]};const an={name:"Flows",components:{Flow:on},props:{bucketWidth:{type:Number,required:!0},steps:{type:Array,required:!0}},data:function(){return{flows:[]}},watch:{steps:{handler:function(){this.buildFlows()},immediate:!0}},methods:{buildFlows:function(){var t=this;this.$nextTick(function(){var e=sn(t.steps);e.sort(function(t,e){return t.source.stepIndex===e.source.stepIndex?t.source.bucketIndex-e.source.bucketIndex:e.source.stepIndex-t.source.stepIndex}),t.flows=e})}}};var hn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",t._l(t.flows,function(e){return n("Flow",{key:e.source.step+"-"+e.source.bucket+"-"+e.target.step+"-"+e.target.bucket,ref:t.flows,refInFor:!0,attrs:{source:e.source,target:e.target,"bucket-width":t.bucketWidth,entities:e.entities}})}),1)};hn._withStripped=!0;const ln={name:"BucketFlowGraph",components:{Step:De,Flows:Xe({render:hn,staticRenderFns:[]},void 0,an,void 0,!1,void 0,void 0,void 0)},props:{data:{type:Object,required:!0},headerHeight:{type:Number,default:40},bucketMargin:{type:Number,default:30},disabledSteps:{type:Array,default:function(){return[]}}},data:function(){return{containerWidth:0,containerHeight:0,yScale:1,flowGradients:{},maxHeight:0,maxHeightMargins:0}},computed:{stepsFlags:function(){return this.disabledSteps.map(function(t){return t?"t":"f"}).join()},steps:function(){var t=this,e=this.data.steps.filter(function(e){return!t.disabledSteps.includes(e.id)});return this.data.entities?function(t,e){var n=t.filter(function(t){return cn(t,"drop")}).map(function(t){return t.id});return e.reduceRight(function(e,r){return[Ee({},r,{buckets:r.buckets.map(function(e,i){return Ee({},e,{entities:t.filter(function(t){return!!cn(t,e.id)&&(r.buckets.some(function(e,n){return n>i&&cn(t,e.id)})&&console.warn("Entity ".concat(t.id," is present in multiple buckets in the same step")),!0)}),drop:t.filter(function(t){if(n.includes(t.id)&&cn(t,e.id)){var r=n.findIndex(function(e){return e.id===t.id});return n.splice(r,1),!0}return!1})})})})].concat(Ye(e))},[])}(this.data.entities,e):e},stepCount:function(){return this.steps.length},bucketWidth:function(){return this.containerWidth/(2*this.stepCount-1)}},created:function(){this.calculateSizeDebounced=je(this.calculateSize,500)},mounted:function(){var t=this;this.calculateSize(),window.addEventListener("resize",function(){return t.calculateSizeDebounced()})},beforeDestroy:function(){var t=this;window.removeEventListener("resize",function(){return t.calculateSizeDebounced()})},methods:{onHeightChange:function(t,e){t+e>this.maxHeight+this.maxHeightMargins&&(this.maxHeight=t,this.maxHeightMargins=e,this.$nextTick(this.calculateYScale))},calculateYScale:function(){var t=Math.floor(100*(this.containerHeight-this.maxHeightMargins)/this.maxHeight*this.yScale)/100;this.yScale=t},stepX:function(t){return 2*t*this.bucketWidth},acquireInputSlot:function(t,e,n,r){return this.$refs.steps.find(function(e){return e.id===t}).acquireInputSlot(e,n,r)},acquireOutputSlot:function(t,e,n,r){return this.$refs.steps.find(function(e){return e.id===t}).acquireOutputSlot(e,n,r)},setGradient:function(t){this.flowGradients=Ee({},this.flowGradients,He({},t.id,t))},calculateSize:function(){var t=this.$refs.container.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n-this.headerHeight-20}},provide:function(){return{acquireInputSlot:this.acquireInputSlot,acquireOutputSlot:this.acquireOutputSlot,setGradient:this.setGradient}}};var fn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"container",staticClass:"container"},[t.containerWidth&&t.containerHeight?n("svg",{staticClass:"svg"},[n("defs",[t._l(t.flowGradients,function(e,r){return n("linearGradient",{key:r,attrs:{id:"gradient-"+r,gradientUnits:"userSpaceOnUse",x1:e.outputX,y1:"0",x2:e.inputX,y2:"0"}},[n("stop",{attrs:{"stop-color":e.fromColor,offset:"0%"}}),t._v(" "),n("stop",{attrs:{"stop-color":e.toColor,offset:"100%"}})],1)}),t._v(" "),n("linearGradient",{attrs:{id:"gradient-drop",x1:"0",y1:"0",x2:"0",y2:"1"}},[n("stop",{attrs:{"stop-color":"#ff5630",offset:"0%"}}),t._v(" "),n("stop",{attrs:{"stop-color":"#ff5630","stop-opacity":"0",offset:"100%"}})],1)],2),t._v(" "),n("g",{attrs:{transform:"translate(0 "+t.headerHeight+")"}},[t._l(t.steps,function(e,r){return n("Step",{key:e.id,ref:"steps",refInFor:!0,attrs:{"step-data":e,"bucket-width":t.bucketWidth,"bucket-margin":t.bucketMargin,x:t.stepX(r),"y-scale":t.yScale,"container-height":t.containerHeight},on:{"height-change":t.onHeightChange}})}),t._v(" "),n("Flows",{key:t.stepsFlags,attrs:{steps:t.steps,bucketWidth:t.bucketWidth}})],2)]):t._e()])};fn._withStripped=!0;export default Xe({render:fn,staticRenderFns:[]},void 0,ln,"data-v-58884e70",!1,void 0,void 0,void 0);
