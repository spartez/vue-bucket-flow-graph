var VueBucketFlowGraph=function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t,e){return t(e={exports:{}},e.exports),e.exports}var i,o,u,s="object",c=function(t){return t&&t.Math==Math&&t},a=c(typeof globalThis==s&&globalThis)||c(typeof window==s&&window)||c(typeof self==s&&self)||c(typeof n==s&&n)||Function("return this")(),h=function(t){try{return!!t()}catch(t){return!0}},l=!h(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),f={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,d={f:p&&!f.call({1:2},1)?function(t){var e=p(this,t);return!!e&&e.enumerable}:f},g=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},b={}.toString,v=function(t){return b.call(t).slice(8,-1)},y="".split,m=h(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==v(t)?y.call(t,""):Object(t)}:Object,S=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},x=function(t){return m(S(t))},k=function(t){return"object"==typeof t?null!==t:"function"==typeof t},w=function(t,e){if(!k(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!k(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!k(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!k(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},_={}.hasOwnProperty,O=function(t,e){return _.call(t,e)},I=a.document,W=k(I)&&k(I.createElement),M=function(t){return W?I.createElement(t):{}},N=!l&&!h(function(){return 7!=Object.defineProperty(M("div"),"a",{get:function(){return 7}}).a}),H=Object.getOwnPropertyDescriptor,E={f:l?H:function(t,e){if(t=x(t),e=w(e,!0),N)try{return H(t,e)}catch(t){}if(O(t,e))return g(!d.f.call(t,e),t[e])}},Y=function(t){if(!k(t))throw TypeError(String(t)+" is not an object");return t},z=Object.defineProperty,j={f:l?z:function(t,e,n){if(Y(t),e=w(e,!0),Y(n),N)try{return z(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},T=l?function(t,e,n){return j.f(t,e,g(1,n))}:function(t,e,n){return t[e]=n,t},q=function(t,e){try{T(a,t,e)}catch(n){a[t]=e}return e},A=r(function(t){var e=a["__core-js_shared__"]||q("__core-js_shared__",{});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.1.3",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),C=A("native-function-to-string",Function.toString),F=a.WeakMap,R="function"==typeof F&&/native code/.test(C.call(F)),X=0,B=Math.random(),P=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++X+B).toString(36)},$=A("keys"),G=function(t){return $[t]||($[t]=P(t))},D={},V=a.WeakMap;if(R){var L=new V,U=L.get,K=L.has,Z=L.set;i=function(t,e){return Z.call(L,t,e),e},o=function(t){return U.call(L,t)||{}},u=function(t){return K.call(L,t)}}else{var J=G("state");D[J]=!0,i=function(t,e){return T(t,J,e),e},o=function(t){return O(t,J)?t[J]:{}},u=function(t){return O(t,J)}}var Q={set:i,get:o,has:u,enforce:function(t){return u(t)?o(t):i(t,{})},getterFor:function(t){return function(e){var n;if(!k(e)||(n=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},tt=r(function(t){var e=Q.get,n=Q.enforce,r=String(C).split("toString");A("inspectSource",function(t){return C.call(t)}),(t.exports=function(t,e,i,o){var u=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,c=!!o&&!!o.noTargetGet;"function"==typeof i&&("string"!=typeof e||O(i,"name")||T(i,"name",e),n(i).source=r.join("string"==typeof e?e:"")),t!==a?(u?!c&&t[e]&&(s=!0):delete t[e],s?t[e]=i:T(t,e,i)):s?t[e]=i:q(e,i)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||C.call(this)})}),et=a,nt=function(t){return"function"==typeof t?t:void 0},rt=function(t,e){return arguments.length<2?nt(et[t])||nt(a[t]):et[t]&&et[t][e]||a[t]&&a[t][e]},it=Math.ceil,ot=Math.floor,ut=function(t){return isNaN(t=+t)?0:(t>0?ot:it)(t)},st=Math.min,ct=function(t){return t>0?st(ut(t),9007199254740991):0},at=Math.max,ht=Math.min,lt=function(t,e){var n=ut(t);return n<0?at(n+e,0):ht(n,e)},ft=function(t){return function(e,n,r){var i,o=x(e),u=ct(o.length),s=lt(r,u);if(t&&n!=n){for(;u>s;)if((i=o[s++])!=i)return!0}else for(;u>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}},pt={includes:ft(!0),indexOf:ft(!1)},dt=pt.indexOf,gt=function(t,e){var n,r=x(t),i=0,o=[];for(n in r)!O(D,n)&&O(r,n)&&o.push(n);for(;e.length>i;)O(r,n=e[i++])&&(~dt(o,n)||o.push(n));return o},bt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],vt=bt.concat("length","prototype"),yt={f:Object.getOwnPropertyNames||function(t){return gt(t,vt)}},mt={f:Object.getOwnPropertySymbols},St=rt("Reflect","ownKeys")||function(t){var e=yt.f(Y(t)),n=mt.f;return n?e.concat(n(t)):e},xt=function(t,e){for(var n=St(e),r=j.f,i=E.f,o=0;o<n.length;o++){var u=n[o];O(t,u)||r(t,u,i(e,u))}},kt=/#|\.prototype\./,wt=function(t,e){var n=Ot[_t(t)];return n==Wt||n!=It&&("function"==typeof e?h(e):!!e)},_t=wt.normalize=function(t){return String(t).replace(kt,".").toLowerCase()},Ot=wt.data={},It=wt.NATIVE="N",Wt=wt.POLYFILL="P",Mt=wt,Nt=E.f,Ht=function(t,e){var n,r,i,o,u,s=t.target,c=t.global,h=t.stat;if(n=c?a:h?a[s]||q(s,{}):(a[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(u=Nt(n,r))&&u.value:n[r],!Mt(c?r:s+(h?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;xt(o,i)}(t.sham||i&&i.sham)&&T(o,"sham",!0),tt(n,r,o,t)}},Et=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Yt=function(t){return Object(S(t))},zt=Array.isArray||function(t){return"Array"==v(t)},jt=!!Object.getOwnPropertySymbols&&!h(function(){return!String(Symbol())}),Tt=a.Symbol,qt=A("wks"),At=function(t){return qt[t]||(qt[t]=jt&&Tt[t]||(jt?Tt:P)("Symbol."+t))},Ct=At("species"),Ft=function(t,e){var n;return zt(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!zt(n.prototype)?k(n)&&null===(n=n[Ct])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},Rt=[].push,Xt=function(t){var e=1==t,n=2==t,r=3==t,i=4==t,o=6==t,u=5==t||o;return function(s,c,a,h){for(var l,f,p=Yt(s),d=m(p),g=function(t,e,n){if(Et(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}(c,a,3),b=ct(d.length),v=0,y=h||Ft,S=e?y(s,b):n?y(s,0):void 0;b>v;v++)if((u||v in d)&&(f=g(l=d[v],v,p),t))if(e)S[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:Rt.call(S,l)}else if(i)return!1;return o?-1:r||i?i:S}},Bt={forEach:Xt(0),map:Xt(1),filter:Xt(2),some:Xt(3),every:Xt(4),find:Xt(5),findIndex:Xt(6)},Pt=At("species"),$t=function(t){return!h(function(){var e=[];return(e.constructor={})[Pt]=function(){return{foo:1}},1!==e[t](Boolean).foo})},Gt=Bt.filter;Ht({target:"Array",proto:!0,forced:!$t("filter")},{filter:function(t){return Gt(this,t,arguments.length>1?arguments[1]:void 0)}});var Dt=Object.keys||function(t){return gt(t,bt)},Vt=l?Object.defineProperties:function(t,e){Y(t);for(var n,r=Dt(e),i=r.length,o=0;i>o;)j.f(t,n=r[o++],e[n]);return t},Lt=rt("document","documentElement"),Ut=G("IE_PROTO"),Kt=function(){},Zt=function(){var t,e=M("iframe"),n=bt.length;for(e.style.display="none",Lt.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Zt=t.F;n--;)delete Zt.prototype[bt[n]];return Zt()},Jt=Object.create||function(t,e){var n;return null!==t?(Kt.prototype=Y(t),n=new Kt,Kt.prototype=null,n[Ut]=t):n=Zt(),void 0===e?n:Vt(n,e)};D[Ut]=!0;var Qt=At("unscopables"),te=Array.prototype;null==te[Qt]&&T(te,Qt,Jt(null));var ee=function(t){te[Qt][t]=!0},ne=Bt.find,re=!0;"find"in[]&&Array(1).find(function(){re=!1}),Ht({target:"Array",proto:!0,forced:re},{find:function(t){return ne(this,t,arguments.length>1?arguments[1]:void 0)}}),ee("find");var ie=pt.includes;Ht({target:"Array",proto:!0},{includes:function(t){return ie(this,t,arguments.length>1?arguments[1]:void 0)}}),ee("includes");var oe=function(t,e){var n=[][t];return!n||!h(function(){n.call(null,e||function(){throw 1},1)})},ue=[].join,se=m!=Object,ce=oe("join",",");Ht({target:"Array",proto:!0,forced:se||ce},{join:function(t){return ue.call(x(this),void 0===t?",":t)}});var ae=Bt.map;Ht({target:"Array",proto:!0,forced:!$t("map")},{map:function(t){return ae(this,t,arguments.length>1?arguments[1]:void 0)}});var he=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return Y(n),function(t){if(!k(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),le="[\t\n\v\f\r                　\u2028\u2029\ufeff]",fe=RegExp("^"+le+le+"*"),pe=RegExp(le+le+"*$"),de=function(t){return function(e){var n=String(S(e));return 1&t&&(n=n.replace(fe,"")),2&t&&(n=n.replace(pe,"")),n}},ge={start:de(1),end:de(2),trim:de(3)},be=yt.f,ve=E.f,ye=j.f,me=ge.trim,Se=a.Number,xe=Se.prototype,ke="Number"==v(Jt(xe)),we=function(t){var e,n,r,i,o,u,s,c,a=w(t,!1);if("string"==typeof a&&a.length>2)if(43===(e=(a=me(a)).charCodeAt(0))||45===e){if(88===(n=a.charCodeAt(2))||120===n)return NaN}else if(48===e){switch(a.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+a}for(u=(o=a.slice(2)).length,s=0;s<u;s++)if((c=o.charCodeAt(s))<48||c>i)return NaN;return parseInt(o,r)}return+a};if(Mt("Number",!Se(" 0o1")||!Se("0b1")||Se("+0x1"))){for(var _e,Oe=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof Oe&&(ke?h(function(){xe.valueOf.call(n)}):"Number"!=v(n))?function(t,e,n){var r,i;return he&&"function"==typeof(r=e.constructor)&&r!==n&&k(i=r.prototype)&&i!==n.prototype&&he(t,i),t}(new Se(we(e)),n,Oe):we(e)},Ie=l?be(Se):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),We=0;Ie.length>We;We++)O(Se,_e=Ie[We])&&!O(Oe,_e)&&ye(Oe,_e,ve(Se,_e));Oe.prototype=xe,xe.constructor=Oe,tt(a,"Number",Oe)}var Me=At("match"),Ne=function(t){if(function(t){var e;return k(t)&&(void 0!==(e=t[Me])?!!e:"RegExp"==v(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t},He=At("match");function Ee(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ye(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){Ee(t,e,n[e])})}return t}function ze(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}Ht({target:"String",proto:!0,forced:!function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[He]=!1,"/./"[t](e)}catch(t){}}return!1}("includes")},{includes:function(t){return!!~String(S(this)).indexOf(Ne(t),arguments.length>1?arguments[1]:void 0)}});const je=(t,e,n={})=>{if(!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let r,i,o=[];return function(...u){return new Promise(s=>{const c=n.leading&&!i;clearTimeout(i),i=setTimeout(()=>{i=null;const e=n.leading?r:t.apply(this,u);for(s of o)s(e);o=[]},e),c?(r=t.apply(this,u),s(r)):o.push(s)})}};var Te=je,qe=je;Te.default=qe;var Ae=Bt.findIndex,Ce=!0;"findIndex"in[]&&Array(1).findIndex(function(){Ce=!1}),Ht({target:"Array",proto:!0,forced:Ce},{findIndex:function(t){return Ae(this,t,arguments.length>1?arguments[1]:void 0)}}),ee("findIndex");var Fe=function(t,e,n){var r=w(e);r in t?j.f(t,r,g(0,n)):t[r]=n},Re=Math.max,Xe=Math.min;Ht({target:"Array",proto:!0,forced:!$t("splice")},{splice:function(t,e){var n,r,i,o,u,s,c=Yt(this),a=ct(c.length),h=lt(t,a),l=arguments.length;if(0===l?n=r=0:1===l?(n=0,r=a-h):(n=l-2,r=Xe(Re(ut(e),0),a-h)),a+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(i=Ft(c,r),o=0;o<r;o++)(u=h+o)in c&&Fe(i,o,c[u]);if(i.length=r,n<r){for(o=h;o<a-r;o++)s=o+n,(u=o+r)in c?c[s]=c[u]:delete c[s];for(o=a;o>a-r+n;o--)delete c[o-1]}else if(n>r)for(o=a-r;o>h;o--)s=o+n-1,(u=o+r-1)in c?c[s]=c[u]:delete c[s];for(o=0;o<n;o++)c[o+h]=arguments[o+2];return c.length=a-r+n,i}});var Be=function(t,e,n,r,i,o,u,s,c,a){"boolean"!=typeof u&&(c=s,s=u,u=!1);var h,l="function"==typeof n?n.options:n;if(t&&t.render&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns,l._compiled=!0,i&&(l.functional=!0)),r&&(l._scopeId=r),o?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,c(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=h):e&&(h=u?function(){e.call(this,a(this.$root.$options.shadowRoot))}:function(t){e.call(this,s(t))}),h)if(l.functional){var f=l.render;l.render=function(t,e){return h.call(e),f(t,e)}}else{var p=l.beforeCreate;l.beforeCreate=p?[].concat(p,h):[h]}return n};const Pe={name:"Bucket",props:{bucket:{type:Object,required:!0},borderRadius:{type:Number,default:0},bucketWidth:{type:Number,required:!0},x:{type:Number,required:!0},y:{type:Number,required:!0},yScale:{type:Number,required:!0},stepScale:{type:Number,required:!0}},data:function(){return{inputSlots:[],outputSlots:[]}},computed:{id:function(){return this.bucket.id},color:function(){return this.bucket.color},title:function(){return this.bucket.title},value:function(){return this.bucket.value||this.bucket.entities.length},height:function(){var t=(this.bucket.value||this.bucket.entities&&this.bucket.entities.length)*this.yScale*this.stepScale;return Math.max(t,3)},dropValue:function(){return this.bucket.drop&&this.bucket.drop.length||0},dropPercent:function(){return Math.round(this.dropValue/this.value*100)},dropHeight:function(){return this.dropValue>0?this.dropValue*this.yScale*this.stepScale:0},dropWidth:function(){return 5+Math.min(40,this.dropHeight)}},watch:{height:{handler:function(t){this.$emit("height-change",t)},immediate:!0}},updated:function(){this.recalculateSlots()},methods:{recalculateSlots:function(){for(var t=0;t<this.inputSlots.length;t+=1){var e=this.inputSlots[t-1]?this.inputSlots[t-1]:{y:this.y,height:0},n=e.y,r=e.height;this.inputSlots[t].x=this.x,this.inputSlots[t].y=n+r,this.inputSlots[t].height=Math.max(this.inputSlots[t].value*this.yScale*this.stepScale,3)}for(var i=0;i<this.outputSlots.length;i+=1){var o=this.outputSlots[i-1]?this.outputSlots[i-1]:{y:this.y,height:0};n=o.y,r=o.height;this.outputSlots[i].x=this.x+this.bucketWidth,this.outputSlots[i].y=n+r,this.outputSlots[i].height=Math.max(this.outputSlots[i].value*this.yScale*this.stepScale,3)}},acquireInputSlot:function(t,e){var n=this,r={value:t,weight:e,x:this.x,y:0,bucketValue:this.value,height:t*this.yScale*this.stepScale,color:this.color,free:function(){return n.freeInputSlot(r)}};return this.inputSlots.push(r),this.recalculateSlots(),this.inputSlots[this.inputSlots.length-1]},acquireOutputSlot:function(t,e){var n=this,r={value:t,weight:e,bucketValue:this.value,x:this.x+this.bucketWidth,y:0,height:t*this.yScale*this.stepScale,color:this.color,free:function(){return n.freeOutputSlot(r)}};return this.outputSlots.push(r),this.recalculateSlots(),this.outputSlots[this.outputSlots.length-1]},freeInputSlot:function(t){var e=this.inputSlots.findIndex(function(e){return e===t});this.inputSlots.splice(e,1)},freeOutputSlot:function(t){var e=this.outputSlots.findIndex(function(e){return e===t});this.outputSlots.splice(e,1)}}};var $e=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{staticClass:"bucket",attrs:{transform:"translate(0 "+t.y+")"}},[n("rect",{attrs:{x:0,y:-t.borderRadius,width:t.bucketWidth,height:t.height+2*t.borderRadius,fill:t.color,rx:t.borderRadius,ry:t.borderRadius}}),t._v(" "),n("g",{attrs:{transform:"translate("+t.bucketWidth/2+" "+t.height/2+")"}},[n("text",{style:{textShadow:"0 0 4px "+t.color},attrs:{"alignment-baseline":"baseline","text-anchor":"middle",x:0,y:-6,stroke:t.color}},[t._v("\n            "+t._s(t.title)+"\n        ")]),t._v(" "),n("text",{staticClass:"value",style:{textShadow:"0 0 4px "+t.color},attrs:{"alignment-baseline":"hanging","text-anchor":"middle",stroke:t.color,x:0,y:0}},[t._v("\n            "+t._s(t.value)+"\n        ")])]),t._v(" "),t.dropHeight>0?n("g",{staticClass:"drop",attrs:{opacity:"0.8",transform:"translate("+t.bucketWidth+" "+(t.height-t.dropHeight)+")"}},[n("path",{attrs:{d:"M 0 0 A "+t.dropWidth+" "+t.dropWidth+" 0 0 1 "+t.dropWidth+" "+t.dropWidth+" L 0 "+t.dropWidth,fill:"#ff5630"}}),t._v(" "),n("rect",{attrs:{x:0,y:t.dropWidth,width:t.dropWidth,height:t.dropHeight,fill:"url(#gradient-drop)",rx:t.borderRadius,ry:t.borderRadius}}),t._v(" "),n("text",{attrs:{x:t.dropWidth-Math.sqrt(t.dropWidth)+5,y:t.dropWidth/2}},[t._v("\n            "+t._s(t.dropPercent)+"%\n        ")])]):t._e()])};$e._withStripped=!0;const Ge={name:"Step",components:{Bucket:Be({render:$e,staticRenderFns:[]},void 0,Pe,"data-v-7360eb64",!1,void 0,void 0,void 0)},props:{stepData:{type:Object,required:!0},bucketWidth:{type:Number,required:!0},bucketMargin:{type:Number,required:!0},borderRadius:{type:Number,default:3},x:{type:Number,required:!0},yScale:{type:Number,required:!0},containerHeight:{type:Number,required:!0}},data:function(){return{bucketsHeights:this.stepData.buckets.map(function(){return 0}),autoScale:1}},computed:{id:function(){return this.stepData.id},title:function(){return this.stepData.title},buckets:function(){return this.stepData.buckets},bucketsY:function(){var t=this,e=0;return this.bucketsHeights.map(function(n){var r=e;return e+=n+t.bucketMargin,r})},bucketsHeightSum:function(){return this.bucketsHeights.reduce(function(t,e){return t+e},0)},marginsSum:function(){return(this.buckets.length-1)*this.bucketMargin},stepScale:function(){return"auto"===this.stepData.scale?this.autoScale/this.yScale:this.stepData.scale||1},xOut:function(){return this.x+this.bucketWidth}},watch:{bucketsHeightSum:{handler:function(t){"auto"!==this.stepData.scale&&this.$emit("height-change",t,this.marginsSum)},immediate:!1}},mounted:function(){"auto"===this.stepData.scale&&this.calculateAutoHeight()},methods:{onBucketHeightChange:function(t,n){e.set(this.bucketsHeights,t,n)},calculateAutoHeight:function(){var t=this.$refs.buckets.reduce(function(t,e){return t+e.value},0),e=(this.buckets.length-1)*this.bucketMargin,n=(this.containerHeight-e)/t;this.autoScale=n},acquireInputSlot:function(t,e,n){return this.$refs.buckets.find(function(e){return e.id===t}).acquireInputSlot(e,n)},acquireOutputSlot:function(t,e,n){return this.$refs.buckets.find(function(e){return e.id===t}).acquireOutputSlot(e,n)}}};var De=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",{staticClass:"step",attrs:{transform:"translate("+t.x+" 0)"}},[n("text",{attrs:{"text-anchor":"middle",x:t.bucketWidth/2,y:-t.borderRadius-20}},[t._v("\n        "+t._s(t.title)+"\n    ")]),t._v(" "),t._l(t.buckets,function(e,r){return n("Bucket",{key:e.title,ref:"buckets",refInFor:!0,attrs:{x:t.x,y:t.bucketsY[r],"y-scale":t.yScale,"step-scale":t.stepScale,bucket:e,"bucket-width":t.bucketWidth},on:{"height-change":function(e){return t.onBucketHeightChange(r,e)}}})})],2)};De._withStripped=!0;var Ve=Be({render:De,staticRenderFns:[]},void 0,Ge,"data-v-8c1326ca",!1,void 0,void 0,void 0),Le=[].sort,Ue=[1,2,3],Ke=h(function(){Ue.sort(void 0)}),Ze=h(function(){Ue.sort(null)}),Je=oe("sort");Ht({target:"Array",proto:!0,forced:Ke||!Ze||Je},{sort:function(t){return void 0===t?Le.call(Yt(this)):Le.call(Yt(this),Et(t))}});var Qe=At("isConcatSpreadable"),tn=!h(function(){var t=[];return t[Qe]=!1,t.concat()[0]!==t}),en=$t("concat"),nn=function(t){if(!k(t))return!1;var e=t[Qe];return void 0!==e?!!e:zt(t)};Ht({target:"Array",proto:!0,forced:!tn||!en},{concat:function(t){var e,n,r,i,o,u=Yt(this),s=Ft(u,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?u:arguments[e],nn(o)){if(c+(i=ct(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,c++)n in o&&Fe(s,c,o[n])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Fe(s,c++,o)}return s.length=c,s}});const rn={name:"Flow",inject:["acquireInputSlot","acquireOutputSlot","setGradient"],props:{source:{type:Object,required:!0},target:{type:Object,required:!0},entities:{type:Array,required:!0},bucketWidth:{type:Number,required:!0}},data:function(){return{output:{x:0,y:0,height:0},input:{x:0,y:0,height:0},labelHeight:0,labelWidth:0}},computed:{value:function(){return this.entities.length},percent:function(){return this.value/this.output.bucketValue},percentFormatted:function(){return this.percent<.01?"<1":Math.round(100*this.percent)},id:function(){return"".concat(this.source.step,"-").concat(this.source.bucket,"-").concat(this.target.step,"-").concat(this.target.bucket)},width:function(){return Math.abs(this.inputX-this.outputX)},outputTopBezier:function(){var t=Math.abs(this.outputY1-this.outputY2),e=Math.abs(this.outputY1-this.inputY1);return this.bezierWidth/2+t/2-e/(this.bezierWidth+1)*3},outputBottomBezier:function(){var t=Math.abs(this.outputY1-this.outputY2),e=Math.abs(this.outputY2-this.inputY2);return this.bezierWidth/2-t/2-e/(this.bezierWidth+1)*3},inputTopBezier:function(){var t=Math.abs(this.inputY1-this.inputY2),e=Math.abs(this.outputY1-this.inputY1);return this.bezierWidth/2+t/2-e/(this.bezierWidth+1)*3},inputBottomBezier:function(){var t=Math.abs(this.inputY1-this.inputY2),e=Math.abs(this.outputY2-this.inputY2);return this.bezierWidth/2-t/2-e/(this.bezierWidth+1)*3},skipsOverNextStep:function(){return this.width>2*this.bucketWidth},extensionWidth:function(){return this.skipsOverNextStep?this.width-this.bucketWidth:0},bezierWidth:function(){return this.skipsOverNextStep?this.width-this.extensionWidth:this.width},bezierHeight1:function(){return Math.round(100*(this.inputY1-this.outputY1))/100},bezierHeight2:function(){return Math.round(100*(this.outputY2-this.inputY2))/100},fontSize:function(){var t=.7+this.value/this.input.bucketValue*.3;return"".concat(t,"em")},labelRadius:function(){return 5},inputHeight:function(){return Math.round(100*Math.abs(this.inputY1-this.inputY2))/100},outputHeight:function(){return Math.round(100*Math.abs(this.outputY1-this.outputY2))/100},hasSameScales:function(){return this.inputHeight===this.outputHeight&&this.outputY1!==this.inputY1},path:function(){return this.hasSameScales?["M ".concat(this.outputX," ").concat(this.outputY1+this.inputHeight/2),this.skipsOverNextStep?"h ".concat(this.extensionWidth):"","c ".concat((this.outputTopBezier+this.outputBottomBezier)/2," ",0,", ").concat((this.inputTopBezier+this.inputBottomBezier)/2," ").concat(this.bezierHeight1,", ").concat(this.bezierWidth," ").concat(this.bezierHeight1)].join(" "):["M ".concat(this.outputX," ").concat(this.outputY1),this.skipsOverNextStep?"h ".concat(this.extensionWidth):"","c ".concat(this.outputTopBezier," ",0,", ").concat(this.inputTopBezier," ").concat(this.bezierHeight1,", ").concat(this.bezierWidth," ").concat(this.bezierHeight1),"L ".concat(this.inputX," ").concat(this.inputY2),"c ".concat(-this.inputBottomBezier," ",0,", ").concat(-this.outputBottomBezier," ").concat(this.bezierHeight2,", ").concat(-this.bezierWidth," ").concat(this.bezierHeight2),this.skipsOverNextStep?"h ".concat(-this.extensionWidth):"","Z"].join(" ")},outputX:function(){return this.output.x},outputY1:function(){return this.output.y},outputY2:function(){return this.output.y+this.output.height},inputX:function(){return this.input.x},inputY1:function(){return this.input.y},inputY2:function(){return this.input.y+this.input.height},middleX:function(){return this.outputX+this.width/2},middleY:function(){return this.skipsOverNextStep?(this.outputY1+this.outputY2)/2:((this.outputY1+this.outputY2)/2+(this.inputY1+this.inputY2)/2)/2}},watch:{fontSize:function(){var t=this;this.$nextTick(function(){var e=t.$refs.labels.getBoundingClientRect(),n=e.width,r=e.height;t.labelHeight=r+4,t.labelWidth=n+8})},inputX:function(){this.setGradient({id:this.id,fromColor:this.output.color,toColor:this.input.color,outputX:this.output.x,inputX:this.input.x})},outputX:function(){this.setGradient({id:this.id,fromColor:this.output.color,toColor:this.input.color,outputX:this.output.x,inputX:this.input.x})},value:function(){this.input.free(),this.output.free(),this.acquireSlots()}},mounted:function(){this.acquireSlots(),this.setFlowGradient()},beforeDestroy:function(){this.input.free(),this.output.free()},methods:{acquireSlots:function(){var t=1e3*Math.abs(this.source.stepIndex-this.target.stepIndex)+this.target.bucketIndex;this.output=this.acquireOutputSlot(this.source.step,this.source.bucket,this.entities.length,t);var e=1e3*Math.abs(this.source.stepIndex-this.target.stepIndex)+this.source.bucketIndex;this.input=this.acquireInputSlot(this.target.step,this.target.bucket,this.entities.length,e)},setFlowGradient:function(){this.setGradient({id:this.id,fromColor:this.output.color,toColor:this.input.color,outputX:this.output.x,inputX:this.input.x})}}};var on=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",[n("g",{staticClass:"flow",attrs:{opacity:"0.5"}},[t.hasSameScales?n("path",{attrs:{stroke:"url('#gradient-"+t.id+"')","stroke-width":t.inputHeight,fill:"none",d:t.path}}):n("path",{attrs:{fill:"url('#gradient-"+t.id+"')",d:t.path}}),t._v(" "),n("rect",{attrs:{fill:"url('#gradient-"+t.id+"')",x:t.middleX-t.labelWidth/2,y:t.middleY-t.labelHeight/2,width:t.labelWidth,height:t.labelHeight,rx:5,ry:5}})]),t._v(" "),n("g",{ref:"labels",staticClass:"labels"},[n("text",{attrs:{"font-size":t.fontSize,x:t.middleX,y:t.middleY-1,"dominant-baseline":"baseline","text-anchor":"middle"}},[t._v("\n            "+t._s(t.percentFormatted)+"%\n        ")]),t._v(" "),n("text",{style:{transformOrigin:t.middleX+"px "+t.middleY+"px",transform:"scale(.7)"},attrs:{"font-size":t.fontSize,x:t.middleX,y:t.middleY+3,"dominant-baseline":"hanging","text-anchor":"middle"}},[t._v("\n            ("+t._s(t.value)+")\n        ")])])])};on._withStripped=!0;var un=Be({render:on,staticRenderFns:[]},void 0,rn,"data-v-05db7b6e",!1,void 0,void 0,void 0),sn=function(t){return t.entities||[]},cn=function(t){return t.reduce(function(e,n,r){return r>=t.length-1?e:[].concat(ze(e),ze(n.buckets.reduce(function(e,i,o){return[].concat(ze(e),ze(sn(i).reduce(function(e,u){var s=function(t,e,n){for(var r=e;r<t.length;r+=1){var i=t[r],o=i.buckets.findIndex(function(t){return sn(t).find(function(t){return t.id===n.id})});if(-1!==o){var u=i.buckets[o];return{step:i.id,stepIndex:r,bucket:u.id,bucketIndex:o}}}}(t,r+1,u);if(!s)return e;var c=e.find(function(t){var e=t.target;return e.step===s.step&&e.bucket===s.bucket});return c?(c.entities=[].concat(ze(c.entities),[u]),e):[].concat(ze(e),[{source:{stepIndex:r,bucketIndex:o,step:n.id,bucket:i.id},target:{stepIndex:s.stepIndex,bucketIndex:s.bucketIndex,step:s.step,bucket:s.bucket},entities:[u]}])},[])))},[])))},[])},an=function(t,e){return t.buckets&&t.buckets[e]};const hn={name:"Flows",components:{Flow:un},props:{bucketWidth:{type:Number,required:!0},steps:{type:Array,required:!0}},data:function(){return{flows:[]}},watch:{steps:{handler:function(){this.buildFlows()},immediate:!0}},methods:{buildFlows:function(){var t=this;this.$nextTick(function(){var e=cn(t.steps);e.sort(function(t,e){return t.source.stepIndex===e.source.stepIndex?t.source.bucketIndex-e.source.bucketIndex:e.source.stepIndex-t.source.stepIndex}),t.flows=e})}}};var ln=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("g",t._l(t.flows,function(e){return n("Flow",{key:e.source.step+"-"+e.source.bucket+"-"+e.target.step+"-"+e.target.bucket,ref:t.flows,refInFor:!0,attrs:{source:e.source,target:e.target,"bucket-width":t.bucketWidth,entities:e.entities}})}),1)};ln._withStripped=!0;const fn={name:"BucketFlowGraph",components:{Step:Ve,Flows:Be({render:ln,staticRenderFns:[]},void 0,hn,void 0,!1,void 0,void 0,void 0)},props:{data:{type:Object,required:!0},headerHeight:{type:Number,default:40},bucketMargin:{type:Number,default:30},disabledSteps:{type:Array,default:function(){return[]}}},data:function(){return{containerWidth:0,containerHeight:0,yScale:1,flowGradients:{},maxHeight:0,maxHeightMargins:0}},computed:{stepsFlags:function(){return this.disabledSteps.map(function(t){return t?"t":"f"}).join()},steps:function(){var t=this,e=this.data.steps.filter(function(e){return!t.disabledSteps.includes(e.id)});return this.data.entities?function(t,e){var n=t.filter(function(t){return an(t,"drop")}).map(function(t){return t.id});return e.reduceRight(function(e,r){return[Ye({},r,{buckets:r.buckets.map(function(e,i){return Ye({},e,{entities:t.filter(function(t){return!!an(t,e.id)&&(r.buckets.some(function(e,n){return n>i&&an(t,e.id)})&&console.warn("Entity ".concat(t.id," is present in multiple buckets in the same step")),!0)}),drop:t.filter(function(t){if(n.includes(t.id)&&an(t,e.id)){var r=n.findIndex(function(e){return e.id===t.id});return n.splice(r,1),!0}return!1})})})})].concat(ze(e))},[])}(this.data.entities,e):e},stepCount:function(){return this.steps.length},bucketWidth:function(){return this.containerWidth/(2*this.stepCount-1)}},created:function(){this.calculateSizeDebounced=Te(this.calculateSize,500)},mounted:function(){var t=this;this.calculateSize(),window.addEventListener("resize",function(){return t.calculateSizeDebounced()})},beforeDestroy:function(){var t=this;window.removeEventListener("resize",function(){return t.calculateSizeDebounced()})},methods:{onHeightChange:function(t,e){t+e>this.maxHeight+this.maxHeightMargins&&(this.maxHeight=t,this.maxHeightMargins=e,this.$nextTick(this.calculateYScale))},calculateYScale:function(){var t=Math.floor(100*(this.containerHeight-this.maxHeightMargins)/this.maxHeight*this.yScale)/100;this.yScale=t},stepX:function(t){return 2*t*this.bucketWidth},acquireInputSlot:function(t,e,n,r){return this.$refs.steps.find(function(e){return e.id===t}).acquireInputSlot(e,n,r)},acquireOutputSlot:function(t,e,n,r){return this.$refs.steps.find(function(e){return e.id===t}).acquireOutputSlot(e,n,r)},setGradient:function(t){this.flowGradients=Ye({},this.flowGradients,Ee({},t.id,t))},calculateSize:function(){var t=this.$refs.container.getBoundingClientRect(),e=t.width,n=t.height;this.containerWidth=e,this.containerHeight=n-this.headerHeight-20}},provide:function(){return{acquireInputSlot:this.acquireInputSlot,acquireOutputSlot:this.acquireOutputSlot,setGradient:this.setGradient}}};var pn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"container",staticClass:"container"},[t.containerWidth&&t.containerHeight?n("svg",{staticClass:"svg"},[n("defs",[t._l(t.flowGradients,function(e,r){return n("linearGradient",{key:r,attrs:{id:"gradient-"+r,gradientUnits:"userSpaceOnUse",x1:e.outputX,y1:"0",x2:e.inputX,y2:"0"}},[n("stop",{attrs:{"stop-color":e.fromColor,offset:"0%"}}),t._v(" "),n("stop",{attrs:{"stop-color":e.toColor,offset:"100%"}})],1)}),t._v(" "),n("linearGradient",{attrs:{id:"gradient-drop",x1:"0",y1:"0",x2:"0",y2:"1"}},[n("stop",{attrs:{"stop-color":"#ff5630",offset:"0%"}}),t._v(" "),n("stop",{attrs:{"stop-color":"#ff5630","stop-opacity":"0",offset:"100%"}})],1)],2),t._v(" "),n("g",{attrs:{transform:"translate(0 "+t.headerHeight+")"}},[t._l(t.steps,function(e,r){return n("Step",{key:e.id,ref:"steps",refInFor:!0,attrs:{"step-data":e,"bucket-width":t.bucketWidth,"bucket-margin":t.bucketMargin,x:t.stepX(r),"y-scale":t.yScale,"container-height":t.containerHeight},on:{"height-change":t.onHeightChange}})}),t._v(" "),n("Flows",{key:t.stepsFlags,attrs:{steps:t.steps,bucketWidth:t.bucketWidth}})],2)]):t._e()])};pn._withStripped=!0;var dn=Be({render:pn,staticRenderFns:[]},void 0,fn,"data-v-58884e70",!1,void 0,void 0,void 0);return t.default=dn,t}({},Vue);
